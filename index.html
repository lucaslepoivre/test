<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Carte OSM - Points depuis Sheet</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100vh; width: 100vw; }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([47.3, -1.5], 9);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    const CSV_URL = "URL_CSV_ICI"; // lien "pub?output=csv"

    fetch(CSV_URL)
      .then(r => r.text())
      .then(text => {
        const lines = text.trim().split("\n");
        for (let i = 1; i < lines.length; i++) {
          const cols = lines[i].split(",");
          const coord = cols[1]; // colonne B
          if (!coord) continue;
          const parts = coord.split(";");
          const ll = coord.split(",");
          if (ll.length < 2) continue;
          const lat = parseFloat(ll[0]);
          const lon = parseFloat(ll[1]);
          if (!isNaN(lat) && !isNaN(lon)) {
            L.marker([lat, lon]).addTo(map).bindPopup("TEST");
          }
        }
      })
      .catch(e => {
        alert("Erreur chargement Google Sheet");
        console.error(e);
      });
  </script>
</body>
</html>
